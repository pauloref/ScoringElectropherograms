function T_total = ImportData(filename)
%% Script that allows user to select files containing Text directory in them. The output is a table 
% with the time and signal of the wells in those files. 
%start_path = 'C:\Users\danie\REM Analytics Dropbox\EPFL_Lab\Megabace1000_data\';
folders = uigetdir2('/Users/danielpacheco/REM Analytics Dropbox/EPFL_Lab/Wet_Lab/Megabace1000_data/MBF15machine/54_primer_assay/');
total_size = 96*length(folders);
curdir = cd;
start = 1501;
last = 2698;
for i=1:length(folders)
    if ismac
        title = split(folders{i},'/');
    else
        title = split(folders{i},'\');
    end
    title = title(end);
    try
        if ismac
            files = dir([folders{i},'/text']);
        else
            files = dir([folders{i},'\text']);
        end
        addpath(genpath(folders{i}));
        if isempty(files)
            printf('Could not locate file');
            continue;
        end
    catch exception
        return;
    end
    j = 0;
    
    %%
    n_files = length(files)-2;
    for file = files'
        
        if file.isdir
            continue;
            
        end
        j=j+1;
        content = importdata(file.name);
        ID = parse_name(title);
        well_id =split(file.name,'.txt'); well_id = well_id(1);
        ID = strjoin([ID,well_id],'_');
        time = repmat('t',[length(content.data(:,1)),1]);
        time = join([string(time),num2str(content.data(:,1))],'_');
        
        signal = content.data(:,5);
        if (j==1 && i==1)
            T_total = array2table(signal(start:min(size(signal,1),last),:)','RowNames',string(ID),'VariableNames',time);
        else
            tab = array2table(signal(start:min(size(signal,1),last),:),'RowNames',ID,'VariableNames',time);
            T_total = vertcat(T_total,tab);
        end
    end
    %
    
end
writetable(T_total,strjoin(string([filename,'.csv'])));
%%


end

